<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Fishbattery Launcher</title>
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self';
        connect-src https: http://localhost:5173 ws://localhost:5173;
        img-src 'self' data: https://crafatar.com https://mc-heads.net https://*.modrinth.com;
        style-src 'self' 'unsafe-inline';
        script-src 'self' 'unsafe-inline'"
    />
  </head>

  <body>
    <div class="app">
      <aside class="sidebar">
        <div class="brand">
          <div class="dot"></div>
          <div>
            <strong>Fishbattery Launcher</strong>
            <small>Underwater fabric launcher</small>
          </div>
        </div>

        <div class="nav">
          <button id="navLibrary" class="active">Library</button>
          <button id="navSettings">Settings</button>
        </div>

        <div class="sidebarFooter">Data is stored per instance in your launcher folder.</div>
      </aside>

      <section class="main">
        <div class="topbar">
          <div class="search">
            <span>Search</span>
            <input id="searchInstances" placeholder="Search instances by name or version" />
          </div>

          <div class="account">
            <button id="accountBtn" class="accountBtn">
              <div class="accountLeft">
                <span class="avatar" id="accountAvatar">
                  <img id="accountAvatarImg" />
                </span>
                <div class="accountMeta">
                  <strong id="accountName">Not signed in</strong>
                  <small id="accountSub">Add an account</small>
                </div>
              </div>
            </button>

            <div id="accountDropdown" class="dropdown">
              <div class="dropdownHeader">Accounts</div>
              <div id="accountItems"></div>
              <div class="popSep"></div>
              <div style="padding:10px 12px">
                <button id="accountAdd" class="btn" style="width:100%">+ Add account</button>
              </div>
            </div>
          </div>
        </div>

        <div id="viewLibrary" class="content">
          <div class="sectionTitle">
            <div>
              <h2>Library</h2>
              <p>Manage instances and launch Minecraft.</p>
            </div>
            <div class="topActions">
              <button id="btnCreate" class="btn btnPrimary">+ Create</button>
              <button id="btnImport" class="btn">Import</button>
              <button id="btnJoinPreferred" class="btn">Join Preferred</button>
              <button id="btnPlayActive" class="btn btnPrimary">Play</button>
              <button id="btnStopActive" class="btn">Stop</button>
            </div>
          </div>

          <div id="instancesGrid" class="grid"></div>

          <div class="logs">
            <div class="logsHeader">
              <strong>Logs</strong>
              <button id="btnAnalyzeLogs" class="btn">Analyze</button>
              <button id="btnApplyDiagnosisFix" class="btn btnPrimary" disabled>Fix</button>
              <button id="btnToggleDiagnosisDetails" class="btn">Details</button>
              <button id="btnCopyDiagnosisReport" class="btn">Copy report</button>
              <div class="spacer"></div>
              <button id="btnClearLogs" class="btn">Clear</button>
            </div>
            <div id="launchDiagnosis" class="launchDiagnosis" style="display:none"></div>
            <div id="launchDiagnosisDetails" class="launchDiagnosisDetails" style="display:none"></div>
            <pre id="logs"></pre>
            <div id="statusText" class="statusText"></div>
          </div>
        </div>

        <div id="viewSettings" class="content" style="display:none">
          <div class="sectionTitle">
            <div>
              <h2>Settings</h2>
              <p>Launcher preferences (stored locally).</p>
            </div>
          </div>

          <div class="settingsLayout">
            <div class="settingsNav">
              <button id="settingsTabGeneral" class="setNavBtn active">General</button>
              <button id="settingsTabTheme" class="setNavBtn">Theme</button>
              <button id="settingsTabInstall" class="setNavBtn">Install</button>
              <button id="settingsTabWindow" class="setNavBtn">Window</button>
              <button id="settingsTabJava" class="setNavBtn">Java</button>
              <button id="settingsTabHooks" class="setNavBtn">Hooks</button>
            </div>

            <div class="settingsPanel">
              <div id="settingsPanelGeneral" class="setPanel"></div>
              <div id="settingsPanelTheme" class="setPanel" style="display:none"></div>
              <div id="settingsPanelInstall" class="setPanel" style="display:none"></div>
              <div id="settingsPanelWindow" class="setPanel" style="display:none"></div>
              <div id="settingsPanelJava" class="setPanel" style="display:none"></div>
              <div id="settingsPanelHooks" class="setPanel" style="display:none"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Modal -->
    <div id="modalBackdrop" class="modalBackdrop">
      <div class="modal">
        <div class="modalHeader">
          <strong id="modalTitle">Create an instance</strong>
          <button id="modalClose" class="iconBtn">Ã¢Å“â€¢</button>
        </div>

        <div class="modalBody">
          <div class="tabs">
            <button id="modalTabGeneral" class="tab active">Edit</button>
            <button id="modalTabMods" class="tab">Mods</button>
            <button id="modalTabPacks" class="tab">Packs</button>
          </div>

          <div id="modalPanelGeneral">
            <div class="field">
              <label>Creation source</label>
              <div class="sourceTabs">
                <button id="createSourceCustom" class="btn btnPrimary" type="button">Custom</button>
                <button id="createSourceImport" class="btn" type="button">Import</button>
                <button id="createSourceModrinth" class="btn" type="button">Modrinth</button>
                <button id="createSourceCurseForge" class="btn" type="button">CurseForge</button>
                <button id="createSourceTechnic" class="btn" type="button">Technic</button>
                <button id="createSourceATLauncher" class="btn" type="button">ATLauncher</button>
                <button id="createSourceFTB" class="btn" type="button">FTB</button>
              </div>
              <div id="createSourceHint" class="muted" style="font-size:12px; margin-top:6px">
                Build a custom instance with manual version + loader selection.
              </div>
            </div>

            <div id="createProviderImport" class="setRow" style="display:none">
              <div>
                <div class="setLabel">Import existing instance/pack</div>
                <div class="setHelp">Supports current launcher import zip flow.</div>
              </div>
              <button id="btnCreateImportNow" class="btn" type="button">Choose file and import</button>
            </div>

            <div id="createProviderMarketplace" class="setRow" style="display:none">
              <div>
                <div id="createProviderMarketplaceTitle" class="setLabel">Pack browser</div>
                <div id="createProviderMarketplaceHelp" class="setHelp">
                  Browse and install Modrinth modpacks into a new isolated instance.
                </div>
                <div id="createModrinthPanel" style="margin-top:10px; display:none">
                  <div class="row" style="gap:8px; justify-content:flex-start">
                    <input id="modrinthSearchInput" class="setControl" placeholder="Search Modrinth modpacks..." style="min-width:260px; flex:1; max-width:none" />
                    <button id="btnModrinthSearch" class="btn" type="button">Search</button>
                  </div>
                  <div id="modrinthResultsLabel" class="setHelp" style="margin-top:8px">Popular modpacks</div>
                  <div id="modrinthSearchResults" style="margin-top:10px; max-height:230px; overflow:auto"></div>
                </div>
                <div id="createCurseForgePanel" style="margin-top:10px; display:none">
                  <div class="row" style="gap:8px; justify-content:flex-start; margin-top:8px">
                    <input id="providerSearchInput" class="setControl" placeholder="Search packs..." style="min-width:260px; flex:1; max-width:none" />
                    <button id="btnProviderSearch" class="btn" type="button">Search</button>
                  </div>
                  <div id="providerResultsLabel" class="setHelp" style="margin-top:8px">Popular packs</div>
                  <div id="providerSearchResults" style="margin-top:10px; max-height:210px; overflow:auto"></div>
                  <div id="providerArchiveActions" style="margin-top:10px">
                    <div class="setHelp" id="providerArchiveHelp">
                      Import provider archive to create a new instance.
                    </div>
                    <div class="row" style="margin-top:10px; justify-content:flex-start">
                    <button id="btnProviderImportArchive" class="btn" type="button">Import pack archive</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="createCustomFields">
            <div class="field">
              <label>Name</label>
              <input id="newName" placeholder="Enter a name for your instance" />
            </div>
            <div class="field">
              <label>Instance icon</label>
              <div class="row" style="justify-content:flex-start; gap:8px">
                <button id="btnPickInstanceIcon" class="btn" type="button">Pick icon</button>
                <button id="btnClearInstanceIcon" class="btn" type="button">Clear</button>
                <button id="btnResetInstanceIconTransform" class="btn" type="button">Reset fit</button>
              </div>
              <div id="instanceIconHint" class="muted" style="font-size:12px; margin-top:6px">No custom icon selected.</div>
              <div id="instanceIconPreviewWrap" style="margin-top:8px; display:none">
                <div id="instanceIconPreviewStatus" class="setHelp">Drag image to reposition. Scroll to zoom.</div>
                <div
                  id="instanceIconPreviewFrame"
                  class="instanceIconPreviewFrame"
                >
                  <img
                    id="instanceIconPreviewImage"
                    alt="Icon preview"
                    style="position:absolute; left:0; top:0; user-select:none; pointer-events:none"
                  />
                </div>
              </div>
              <div id="instanceIconTransformControls" style="margin-top:8px">
                <div class="setHelp">Resize and reposition custom icon</div>
                <div class="row" style="justify-content:flex-start; gap:8px; margin-top:6px">
                  <label for="instanceIconScale" style="min-width:78px">Zoom</label>
                  <input id="instanceIconScale" type="range" min="50" max="250" step="1" value="100" style="flex:1" />
                  <span id="instanceIconScaleValue" class="muted" style="font-size:12px; min-width:48px">100%</span>
                </div>
                <div class="row" style="justify-content:flex-start; gap:8px; margin-top:4px; display:none">
                  <label for="instanceIconOffsetX" style="min-width:78px">Position X</label>
                  <input id="instanceIconOffsetX" type="range" min="-100" max="100" step="1" value="0" style="flex:1" />
                  <span id="instanceIconOffsetXValue" class="muted" style="font-size:12px; min-width:48px">0%</span>
                </div>
                <div class="row" style="justify-content:flex-start; gap:8px; margin-top:4px; display:none">
                  <label for="instanceIconOffsetY" style="min-width:78px">Position Y</label>
                  <input id="instanceIconOffsetY" type="range" min="-100" max="100" step="1" value="0" style="flex:1" />
                  <span id="instanceIconOffsetYValue" class="muted" style="font-size:12px; min-width:48px">0%</span>
                </div>
              </div>
            </div>

            <div class="field">
              <label>Account</label>
              <select id="instanceAccount"></select>
              <div class="muted" style="font-size:12px; margin-top:6px">
                This instance will always launch with this account.
              </div>
            </div>

            <div class="row">
              <div class="field" style="flex:1">
                <label>Game version</label>
                <select id="newVersion"></select>
                <div class="row" style="justify-content:flex-start; gap:8px; margin-top:8px">
                  <button id="createFilterReleases" class="filterToggle active" type="button">Releases</button>
                  <button id="createFilterSnapshots" class="filterToggle" type="button">Snapshots</button>
                </div>
              </div>
              <div class="field" style="width:160px">
                <label>Memory (MB)</label>
                <input id="newMem" placeholder="4096" />
              </div>
            </div>

            <div class="row">
              <div class="field" style="flex:1">
                <label>Mod loader</label>
                <select id="createLoaderType">
                  <option value="vanilla">Vanilla</option>
                  <option value="fabric" selected>Fabric</option>
                  <option value="quilt">Quilt</option>
                  <option value="forge">Forge</option>
                  <option value="neoforge">NeoForge</option>
                </select>
              </div>
              <div class="field" style="flex:1">
                <label>Loader version</label>
                <input id="createLoaderVersion" placeholder="Auto (recommended)" disabled />
                <div id="createLoaderHint" class="muted" style="font-size:12px; margin-top:6px">
                  Auto-picked for Fabric from official metadata.
                </div>
              </div>
            </div>

            <div class="field">
              <label>Instance preset</label>
              <select id="instancePreset"></select>
              <div class="muted" style="font-size:12px; margin-top:6px">
                Applies curated mods and packs for this instance.
              </div>
            </div>

            <div class="row" style="justify-content:space-between; align-items:center">
              <div class="muted" style="font-size:12px">One-click hardware optimization</div>
              <div class="row" style="gap:8px">
                <select id="optProfile" style="min-width:180px">
                  <option value="conservative">Conservative</option>
                  <option value="balanced" selected>Balanced</option>
                  <option value="aggressive">Aggressive</option>
                </select>
                <button id="btnOptimizeInstance" class="btn">Optimize Instance</button>
                <button id="btnRestoreOptimization" class="btn">Restore Defaults</button>
              </div>
            </div>

            <div class="row" style="justify-content:space-between; align-items:center; margin-top:10px">
              <div class="muted" style="font-size:12px">Instance benchmark (synthetic baseline)</div>
              <div class="row" style="gap:8px">
                <button id="btnRunBenchmark" class="btn">Run Benchmark</button>
              </div>
            </div>

            <div style="height:16px"></div>
            <div class="field">
              <label>Servers for this instance</label>
              <div class="row" style="gap:8px">
                <input id="serverNameInput" placeholder="Server name (e.g. Friend SMP)" />
                <input id="serverAddressInput" placeholder="Address (e.g. play.example.com)" />
                <button id="btnSaveServerEntry" class="btn">Save</button>
              </div>
              <div id="serverList" style="margin-top:10px"></div>
              <div class="row" style="gap:8px; margin-top:8px">
                <button id="btnExportServerProfile" class="btn">Export Server Profile</button>
                <button id="btnImportServerProfile" class="btn">Import Server Profile</button>
              </div>
            </div>
            </div>
          </div>

          <div id="modalPanelMods" style="display:none">
            <div class="row" style="justify-content:space-between; align-items:center">
              <div>
                <div class="muted" id="modalModsHint">Select an instance first.</div>
                <div class="muted" style="font-size:12px">
                  Toggles apply instantly. Use "Update Mods" to fetch the newest compatible files.
                </div>
              </div>
              <button id="modalUpdateMods" class="btn">Update Mods</button>
            </div>

            <div style="height:12px"></div>
            <div id="modalCompatGuidance"></div>

            <div style="height:12px"></div>
            <div id="modalModsList"></div>

            <div style="height:16px"></div>
            <div class="row" style="justify-content:space-between; align-items:center">
              <div>
                <div class="muted" style="font-size:12px">
                  Local mods (.jar) you manually add to this instance.
                </div>
              </div>
              <div class="row" style="gap:8px">
                <button id="modalUploadLocalMod" class="btn">Upload .jar</button>
                <button id="modalOpenInstanceFolder" class="btn">Open Folder</button>
              </div>
            </div>

            <div style="height:12px"></div>
            <div id="modalLocalModsList"></div>
          </div>

          <div id="modalPanelPacks" style="display:none">
            <div class="row" style="justify-content:space-between; align-items:center">
              <div>
                <div class="muted" style="font-size:12px">
                  Recommended packs are resolved from Modrinth for this Minecraft version.
                </div>
              </div>
              <button id="modalUpdatePacks" class="btn">Update Packs</button>
            </div>
            <div style="height:12px"></div>
            <div id="recommendedPacksList"></div>

            <div style="height:18px"></div>
            <div class="muted" style="font-size:12px; margin-bottom:10px">
              Upload shader packs (.zip) and resource packs (.zip) into this instance.
            </div>

            <div class="row" style="justify-content:space-between; align-items:center">
              <strong style="font-size:13px">Resource packs</strong>
              <div class="row" style="gap:8px">
                <button id="btnUploadResourcepack" class="btn">Upload .zip</button>
                <button id="btnOpenInstanceFolder2" class="btn">Open Folder</button>
              </div>
            </div>
            <div style="height:10px"></div>
            <div id="resourcepacksList"></div>

            <div style="height:18px"></div>

            <div class="row" style="justify-content:space-between; align-items:center">
              <strong style="font-size:13px">Shader packs</strong>
              <div class="row" style="gap:8px">
                <button id="btnUploadShaderpack" class="btn">Upload .zip</button>
                <button id="btnOpenInstanceFolder3" class="btn">Open Folder</button>
              </div>
            </div>
            <div style="height:10px"></div>
            <div id="shaderpacksList"></div>
          </div>
        </div>

        <div class="modalFooter">
          <button id="modalCancel" class="btn">Cancel</button>
          <button id="modalCreate" class="btn btnPrimary">Save</button>
        </div>
      </div>
    </div>

    <script type="module" src="./main.ts"></script>
  </body>
</html>
